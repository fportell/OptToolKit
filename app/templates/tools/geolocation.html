{% extends "base.html" %}

{% block title %}Geolocation Tool - OpsToolKit{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="mb-2">
                    <i class="bi bi-geo-alt-fill text-primary"></i>
                    Geolocation Tool
                </h2>
                <p class="text-muted mb-0">
                    Select countries to determine area attribution and format affected locations for reporting
                </p>
            </div>
            <a href="{{ url_for('landing.tools') }}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Back to Tools
            </a>
        </div>

        <!-- Info Alert -->
        <div class="alert alert-info alert-dismissible fade show" role="alert">
            <i class="bi bi-info-circle-fill me-2"></i>
            <strong>About this tool:</strong> Select one or more countries to generate standardized reporting language.
            The tool uses UN M49 regional standards to determine appropriate area attribution.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <!-- Main Content Card -->
        <div class="card shadow-sm">
            <div class="card-body">
                <form method="POST" action="{{ url_for('geolocation.process') }}" id="geolocationForm">
                    <!-- Country Selection -->
                    <div class="mb-4">
                        <label for="countrySelect" class="form-label fw-bold">
                            <i class="bi bi-globe me-2"></i>Select Countries
                        </label>
                        <select
                            class="form-select"
                            id="countrySelect"
                            name="countries"
                            multiple
                            size="15"
                            required
                            style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 14px;"
                        >
                            {% for country in countries %}
                            <option value="{{ country }}">{{ country }}</option>
                            {% endfor %}
                        </select>
                        <div class="form-text">
                            <i class="bi bi-lightbulb me-1"></i>
                            Hold Ctrl (Windows/Linux) or Cmd (Mac) to select multiple countries.
                            <span class="text-primary fw-bold" id="selectionCount">0 selected</span>
                        </div>
                    </div>

                    <!-- Search Filter -->
                    <div class="mb-4">
                        <label for="searchCountry" class="form-label">
                            <i class="bi bi-search me-2"></i>Search Countries
                        </label>
                        <input
                            type="text"
                            class="form-control"
                            id="searchCountry"
                            placeholder="Type to filter countries..."
                            autocomplete="off"
                        >
                    </div>

                    <!-- Quick Select Buttons -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">Quick Actions</label>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-secondary btn-sm" id="selectAll">
                                <i class="bi bi-check-all"></i> Select All
                            </button>
                            <button type="button" class="btn btn-outline-secondary btn-sm" id="clearAll">
                                <i class="bi bi-x-circle"></i> Clear All
                            </button>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="bi bi-geo-fill me-2"></i>
                            Locate & Generate Report
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Help Section -->
        <div class="card mt-4 border-secondary">
            <div class="card-header bg-secondary text-white">
                <i class="bi bi-question-circle-fill me-2"></i>How to Use
            </div>
            <div class="card-body">
                <h6 class="fw-bold">Area Attribution Logic:</h6>
                <ul class="mb-3">
                    <li><strong>Single country:</strong> Returns the country name</li>
                    <li><strong>Same region:</strong> Returns the region name (e.g., "Southern Asia")</li>
                    <li><strong>Same continent:</strong> Returns the continent name (e.g., "Europe")</li>
                    <li><strong>All continents:</strong> Returns "Worldwide"</li>
                    <li><strong>Multiple regions:</strong> Returns "Multiregional"</li>
                </ul>
                <hr>
                <h6 class="fw-bold mt-3">Affected Locations Formatting:</h6>
                <ul class="mb-0">
                    <li>1 country: "Canada"</li>
                    <li>2 countries: "Canada and USA"</li>
                    <li>3+ countries: "Canada, Mexico, and USA"</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const selectElement = document.getElementById('countrySelect');
    const searchInput = document.getElementById('searchCountry');
    const countDisplay = document.getElementById('selectionCount');
    const selectAllBtn = document.getElementById('selectAll');
    const clearAllBtn = document.getElementById('clearAll');
    const allOptions = Array.from(selectElement.options);

    // Update selection count
    function updateCount() {
        const count = Array.from(selectElement.selectedOptions).length;
        countDisplay.textContent = `${count} selected`;
        countDisplay.className = count > 0 ? 'text-success fw-bold' : 'text-primary fw-bold';
    }

    // Search filter
    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();

        allOptions.forEach(option => {
            const text = option.textContent.toLowerCase();
            const matches = text.includes(searchTerm);
            option.style.display = matches ? '' : 'none';
        });
    });

    // Select all visible options
    selectAllBtn.addEventListener('click', function() {
        allOptions.forEach(option => {
            if (option.style.display !== 'none') {
                option.selected = true;
            }
        });
        updateCount();
    });

    // Clear all selections
    clearAllBtn.addEventListener('click', function() {
        Array.from(selectElement.options).forEach(option => {
            option.selected = false;
        });
        updateCount();
    });

    // Update count on selection change
    selectElement.addEventListener('change', updateCount);

    // Initial count
    updateCount();
});
</script>
{% endblock %}
